<!DOCTYPE html>
<html>
	<head>
		<title>index.html</title>
	</head>
	<style>
		html, body {
			margin: 0;
			height: 100%;

			background: black;
		}

		.editor {
			box-sizing: border-box;
			white-space: pre;
			width: calc(50% - 2px);
			height: calc(100% - 2px);
			border: 1px solid #a9ff0066;
			background: black;
			color: white;
			margin: 1px;
		}

		.editor.left {
			float: left;
		}

		.editor.right {
			float: right;
			width: calc(50% - 1px);
			margin-left: 0;
		}

		.editor:focus {
			border: 1px solid #a9ff00d1;
			outline: none;
		}
	</style>
	<body>
		<textarea class="editor left classic">
		</textarea>
		<div class="editor right new" tabIndex=1></div>

		<script>
			let fs = require('fs')
			let file = fs.readFileSync('./index.html', 'utf8')

			let editor = document.querySelector('.editor.classic')
			editor.value = file

			// cannot be seen
//			console.log('file', file)

			// does not work
//			win.showDevTools()

			// tab inserts a tab instead of the usual
			editor.addEventListener('keydown', function(e) {
				if (e.keyCode === 9) {
					e.preventDefault()
					let pos = this.selectionStart
					let before = this.value.substring(0, this.selectionStart)
					let after = this.value.substring(this.selectionStart)
					this.value = before + '\t' + after
					this.selectionStart = pos + 1
					this.selectionEnd = pos + 1
				}
			})

			// cmd-s to save
			window.addEventListener('keydown', function(e) {
				if ((window.navigator.platform.match('Mac') ? e.metaKey : e.ctrlKey)
					&& e.keyCode === 83
				) {
					e.preventDefault()

					fs.writeFileSync('index.html', editor.value, 'utf8')
					alert('index.html saved')
  				}
			})

			editor.focus()
		</script>
	</body>
</html>
